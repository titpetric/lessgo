package main

import (
	"fmt"

	"github.com/titpetric/lessgo/ast"
	"github.com/titpetric/lessgo/parser"
)

func main() {
	src := `.slide h1 {
	color: red;
}

.slide {
	h1, h2, h3 {
		a {
			background: none;
		}
	}
}`

	lexer := parser.NewLexer(src)
	tokens := lexer.Tokenize()
	p := parser.NewParserWithSource(tokens, src)
	stylesheet, err := p.Parse()
	if err != nil {
		fmt.Printf("Parse Error: %v\n", err)
		return
	}

	fmt.Printf("Stylesheet has %d top-level rules\n\n", len(stylesheet.Rules))
	for i, rule := range stylesheet.Rules {
		if r, ok := rule.(*ast.Rule); ok {
			fmt.Printf("Rule %d:\n", i)
			fmt.Printf("  Selector parts: %v\n", r.Selector.Parts)
			fmt.Printf("  Declarations: %d\n", len(r.Declarations))
			fmt.Printf("  Nested rules: %d\n", len(r.Rules))
			for j, nested := range r.Rules {
				if nr, ok := nested.(*ast.Rule); ok {
					fmt.Printf("    Nested %d: parts=%v, decl=%d, rules=%d\n", j, nr.Selector.Parts, len(nr.Declarations), len(nr.Rules))
				}
			}
		} else if m, ok := rule.(*ast.MixinCall); ok {
			fmt.Printf("Rule %d: MixinCall path=%v, args=%d\n", i, m.Path, len(m.Arguments))
		} else {
			fmt.Printf("Rule %d: other type=%T\n", i, rule)
		}
	}
}
